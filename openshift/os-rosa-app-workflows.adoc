---
sidebar: sidebar 
permalink: openshift/os-rosa-app-workflows.html 
keywords: OpenShift, OCP, Trident, NetApp ONTAP, Red Hat OpenShift Service on AWS, 
summary: 使用NetApp ONTAP在 AWS 上提供 Red Hat OpenShift 服務 
---
= 使用NetApp ONTAP在 AWS 上提供 Red Hat OpenShift 服務
:hardbreaks:
:allow-uri-read: 
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ../media/


[role="lead"]
本文檔將概述如何將NetApp ONTAP與 AWS 上的 Red Hat OpenShift 服務 (ROSA) 結合使用。



== 建立磁碟區快照

**1.建立應用程式磁碟區的快照** 在本節中，我們將展示如何建立與應用程式關聯的磁碟區的 trident 快照。這將是應用程式資料的時間點副本。如果應用程式資料遺失，我們可以從該時間點的副本恢復資料。注意：此快照與ONTAP中的原始磁碟區儲存在同一個聚合中（本地或雲端）。因此，如果ONTAP儲存聚合遺失，我們將無法從其快照中復原應用程式資料。

**一個。建立 VolumeSnapshotClass 將以下清單保存在名為volume-snapshot-class.yaml的檔案中

[source]
----
apiVersion: snapshot.storage.k8s.io/v1
kind: VolumeSnapshotClass
metadata:
 name: fsx-snapclass
driver: csi.trident.netapp.io
deletionPolicy: Delete
----
使用上述清單建立快照。

image:redhat-openshift-container-rosa-020.png["快照類"]

**b.接下來，建立一個快照**透過建立 VolumeSnapshot 來建立現有 PVC 的快照，以取得 Postgresql 資料的時間點副本。這會建立一個幾乎不佔用檔案系統後端空間的 FSx 快照。將以下清單保存在名為volume-snapshot.yaml的檔案中：

[source]
----
apiVersion: snapshot.storage.k8s.io/v1
kind: VolumeSnapshot
metadata:
 name: postgresql-volume-snap-01
spec:
 volumeSnapshotClassName: fsx-snapclass
 source:
   persistentVolumeClaimName: data-postgresql-0
----
**c.建立磁碟區快照並確認已建立**

刪除資料庫模擬資料遺失（資料遺失可能因為多種原因發生，這裡我們只是透過刪除資料庫來模擬）

image:redhat-openshift-container-rosa-021.png["卷快照"]

**d.刪除資料庫以模擬資料遺失（資料遺失可能由於多種原因而發生，這裡我們只是透過刪除資料庫來模擬）**

image:redhat-openshift-container-rosa-022.png["資料庫連線"]

image:redhat-openshift-container-rosa-023.png["刪除資料庫"]



== 從磁碟區快照還原

**1.從快照還原** 在本節中，我們將展示如何從應用程式磁碟區的 trident 快照還原應用程式。

**一個。從快照建立磁碟區克隆**

若要將磁碟區還原到先前的狀態，您必須根據所拍攝快照中的資料建立新的 PVC。為此，請將以下清單儲存在名為 pvc-clone.yaml 的檔案中

[source]
----
apiVersion: v1
kind: PersistentVolumeClaim
metadata:
 name: postgresql-volume-clone
spec:
 accessModes:
   - ReadWriteOnce
 storageClassName: trident-csi
 resources:
   requests:
     storage: 8Gi
 dataSource:
   name: postgresql-volume-snap-01
   kind: VolumeSnapshot
   apiGroup: snapshot.storage.k8s.io
----
使用上述清單，透過使用快照作為來源建立 PVC 來建立磁碟區的複製。應用清單並確保創建克隆。

image:redhat-openshift-container-rosa-024.png["從快照複製 postgresql"]

**b.刪除原始 postgresql 安裝**

image:redhat-openshift-container-rosa-025.png["postgresql應用程式刪除"]

**c.使用新的克隆 PVC 建立新的 postgresql 應用程式**

[source]
----
$ helm install postgresql bitnami/postgresql --set primary.persistence.enabled=true --set primary.persistence.existingClaim=postgresql-volume-clone -n postgresql
----
image:redhat-openshift-container-rosa-026.png["postgresql全新安裝"]

**d.驗證應用程式 pod 處於運行狀態**

image:redhat-openshift-container-rosa-027.png["postgresql全新安裝"]

**e.驗證 Pod 是否使用克隆作為其 PVC**

image:redhat-openshift-container-rosa-028.png["postgresql新安裝說明"]

image:redhat-openshift-container-rosa-029.png["新的 pvc 是克隆"]

f) 若要驗證資料庫是否已如預期恢復，請返回容器控制台並顯示現有資料庫

image:redhat-openshift-container-rosa-030.png["資料庫已恢復"]



== 示範影片

.使用託管控制平面在 AWS 上將Amazon FSx for NetApp ONTAP與 Red Hat OpenShift 服務結合使用
video::213061d2-53e6-4762-a68f-b21401519023[panopto,width=360]
可以找到更多關於 Red Hat OpenShift 和 OpenShift 解決方案的視頻link:../videos/openshift-videos.html["這裡"]。
